<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">

    </head>
    
    <body>
        <div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a>
                    <cite>导航元素</cite></a>
            </span>
            <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
                <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
            </a>
        </div>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
<!--                        <div class="layui-card-body ">-->
<!--                            <form class="layui-form layui-col-space5">-->
<!--                                <div class="layui-input-inline layui-show-xs-block">-->
<!--                                    <input class="layui-input" placeholder="开始日" name="start" id="start"></div>-->
<!--                                <div class="layui-input-inline layui-show-xs-block">-->
<!--                                    <input class="layui-input" placeholder="截止日" name="end" id="end"></div>-->
<!--                                <div class="layui-input-inline layui-show-xs-block">-->
<!--                                    <select name="contrller">-->
<!--                                        <option>支付方式</option>-->
<!--                                        <option>支付宝</option>-->
<!--                                        <option>微信</option>-->
<!--                                        <option>货到付款</option></select>-->
<!--                                </div>-->
<!--                                <div class="layui-input-inline layui-show-xs-block">-->
<!--                                    <select name="contrller">-->
<!--                                        <option value="">订单状态</option>-->
<!--                                        <option value="0">待确认</option>-->
<!--                                        <option value="1">已确认</option>-->
<!--                                        <option value="2">已收货</option>-->
<!--                                        <option value="3">已取消</option>-->
<!--                                        <option value="4">已完成</option>-->
<!--                                        <option value="5">已作废</option></select>-->
<!--                                </div>-->
<!--                                <div class="layui-input-inline layui-show-xs-block">-->
<!--                                    <input type="text" name="username" placeholder="请输入订单号" autocomplete="off" class="layui-input"></div>-->
<!--                                <div class="layui-input-inline layui-show-xs-block">-->
<!--                                    <button class="layui-btn" lay-submit="" lay-filter="sreach">-->
<!--                                        <i class="layui-icon">&#xe615;</i></button>-->
<!--                                </div>-->
<!--                            </form>-->
<!--                        </div>-->


                        <table id="userTable" lay-filter="userTable"></table>
                        <div id="userToolBar"  style="display: none" class="layui-btn-group">

                            <button type="button" data-type="getCheckData"  class="layui-btn" lay-event="delAll123">批量删除</button>

                        </div>
                        <div style="display: none" id="userBar">
                            <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                            <a class="layui-btn layui-btn-xs" onclick="xadmin.open('添加用户','order-update.jsp',600,400,true)" lay-event="edit">编辑</a>
                            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script src="./js/jquery.min.js"></script>
    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script>




        layui.use(['table','jquery','layer','upload','laydate','form'], function(){
            var table = layui.table;
            var layer = layui.layer;
            var laydate = layui.laydate;
            var $ = layui.jquery, layer = layui.layer;


            table.on('toolbar(userTable)', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                switch(obj.event){

                    case 'delAll123':
                        layer.msg('删除选中');
                        var checkStatus = table.checkStatus('idTest'); //idTest 即为基础参数 id 对应的值
                        //判断是否选中
                        if (checkStatus.data.length==0){
                            layer.msg("未选中！")
                            return;
                        }
                        //捉到所有被选中的对象,进行异步删除
                        var u_ids="";
                        if (checkStatus.data.length>0){
                            for(var i=0;i<checkStatus.data.length;i++){
                                u_ids+=checkStatus.data[i].n_id+",";
                            }
                        }
                        layer.confirm('确认删除吗?'+u_ids,{icon: 3, title:"确认"},function (index) {
                            $.post("/newsWeb/deleteTheSelectedNewsContentServlet?u_ids="+u_ids,function (json) {
                                layer.msg(json);
                                return;
                            });

                        });
                        break;
                };
            });



            //第一个实例
            table.render({
                elem: '#userTable'
                ,height: 542
                ,limit:10
                ,url:'/newsWeb/findNewsContentServlet?url=findNewsContentServlet'//数据接口
                ,page: true //开启分页
                ,toolbar: "#userToolBar"
                ,cols: [[ //表头
                    {type:'checkbox',align:'center',LAY_CHECKED:false,filter:'test'}
                    ,{field: 'n_id', title: '新闻ID', width:100, sort: true}
                    ,{field: 'username', title: '作者', width:100}
                    ,{field: 'head', title: '新闻标题', width:100}
                    ,{field: 'content', title: '新闻内容', width:100, }
                    ,{field: 'like', title: '点赞', width:100,sort: true}
                    ,{field: 'page_view', title: '浏览量', width: 100,sort: true}
                    ,{field: 'add_time', title: '添加时间', width: 100, sort: true}
                    ,{field: 'collect', title: '收藏', width: 100, sort: true}
                    ,{field: 'right', title: '操作',toolbar:'#userBar', width: 200}
                ]]
                ,id:"idTest"
            });



            //监听复选框
            table.on('checkbox(userTable)', function(obj){

                console.log(obj.checked); //当前是否选中状态
                console.log(obj.data); //选中行的相关数据
                console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
            });

            //监听工具条
            table.on('tool(userTable)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）

                if(layEvent === 'detail'){ //查看
                    //do somehing
                    layer.close(data.u_id);

                    location.href="/newsWeb/findNewsContent?n_id="+data.n_id;

                } else if(layEvent === 'del'){ //删除
                    layer.confirm('真的删除行么', function(index){
                        obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                        layer.close(index);
                        //向服务端发送删除指令
                        $.post("/newsWeb/deleteNewsContentServlet?n_id="+data.n_id,function (json) {

                            alert(json);
                        });
                    });
                } else if(layEvent === 'edit'){ //编辑
                    //do something
                    location.href="/newsWeb/getNewsContentServlet?n_id="+data.n_id;
                    //同步更新缓存对应的值

                }
            });


        });

    </script>
</html>